---
title: 分享
categories:
  - 尺工
 
date: 2017-08-25 18:21:22
---
<p></p>
<!-- more -->

## 分享
哇，这个东西烦了我一天。

## 原理
主要是用到 jsBridge 来实现网页和应用之间的通信。实现可以互相发状态

这个主要得看不同 app 内的实现，去找他们的 api。

## 微信
微信页面分享比较麻烦。
首先得有微信公众号，然后得到 appId,之后要在微信公众平台上设置受访域名。
之后外链微信的 jsdk ，它会注册一个 window 下的全局对象 wx。
然后这里需要服务端做一个逻辑，返回给你一些设置信息去初始化设置 wx.config()
当 wx.config() 这个接口完成后会触发 wx.ready(cb)。然后执行回调 cb 这个自己写的方法。这时才能用微信的方法 

## qq
qq浏览器比较简答，但是不知道有时候不生效是个什么鬼。。

## 代码
```
<script src="http://open.mobile.qq.com/sdk/qqapi.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
```

share.js
```
import vm from './main.js'
var share = {
	config: {
		title: '',
		link: '',
		img: '',
		desc: '',
		appid: '',

	},
	init() {
		vm.$http.post('http://test.mrpyq.com/api/weixin/jsapi_sign', {
			url: location.href.split("#")[0] //不带hash，query
		}).then(
			(res) => {
				wx.config({
					debug: false,
					appId: share.config.appid,
					timestamp: res.body.timestamp,
					nonceStr: res.body.noncestr,
					signature: res.body.signature,
					jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareQZone'] //需要使用的微信方法
				});
				this.wx();
			}
		)
		this.qq();
	},
	wx() {
		if (window.wx) {
			wx.ready(function () {
				wx.onMenuShareTimeline({
					title: share.config.title, // 分享标题
					link: share.config.link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
					imgUrl: share.config.img, // 分享图标
					success: function () {
						// 用户确认分享后执行的回调函数
					},
					cancel: function () {
						// 用户取消分享后执行的回调函数
					}
				});
				wx.onMenuShareAppMessage({
					title: share.config.title, // 分享标题
					desc: share.config.desc, // 分享描述
					link: share.config.link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
					imgUrl: share.config.img, // 分享图标
					type: '', // 分享类型,music、video或link，不填默认为link
					dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
					success: function () {
						// 用户确认分享后执行的回调函数
					},
					cancel: function () {
						// 用户取消分享后执行的回调函数
					}
				});

				wx.onMenuShareQQ({
					title: share.config.title, // 分享标题
					desc: share.config.desc, // 分享描述
					link: share.config.link, // 分享链接
					imgUrl: share.config.img, // 分享图标
					success: function () {
						// 用户确认分享后执行的回调函数
					},
					cancel: function () {
						// 用户取消分享后执行的回调函数
					}
				});

				wx.onMenuShareQZone({
					title: share.config.title, // 分享标题
					desc: share.config.desc, // 分享描述
					link: share.config.link, // 分享链接
					imgUrl: share.config.img, // 分享图标
					success: function () {
						// 用户确认分享后执行的回调函数
					},
					cancel: function () {
						// 用户取消分享后执行的回调函数
					}
				});
			})
			wx.error(function (res) {

			});
		}
	},
	qq() {
		if (window.mqq) {
			if (mqq.ui.setOnShareHandler) {
				mqq.ui.setOnShareHandler(function (type) {
					mqq.ui.shareMessage({
						title: share.config.title,
						desc: share.config.desc,
						share_type: type,
						share_url: window.OPEN_DATA.shareurlk,
						image_url: share.config.img,
						back: true
					}, function (result) {
						//result
					});
				});
			}
			if (mqq.invoke) {
				window.mqq.invoke("data", "setShareInfo", {
					share_url: window.OPEN_DATA && window.OPEN_DATA.shareurl,
					title: share.config.title,
					desc: share.config.desc,
					image_url: share.config.img,
					callback: function () {}
				});

			}
		}
	},
}

export default share;

```
配置填下 config 
微信的话接口需要后台做些逻辑，比如生成签名
另外 qq 说 meta 也有用，不过我试了下没用
```
<meta itemprop="name" content="标题" />
<meta itemprop="image" content="图片地址" />
<meta name="description" itemprop="description" content="描述" />
```
