---
title: 内部滑动不触发外部滑动
categories:
- 尺工
 
date: 2016-12-24 14:41:14
---
<p></p>
<!-- more -->
## 问题
最近工作的时候遇到一个问题，在页面中如果出现了2个滑动元素，比如浏览器的滚动条和一个div内的滚动条，当div内部的滚动条滚动到最底部的时候，接下来会默认触发浏览器的滚动条，这是浏览器的默认行为，是没有任何问题的，但是！在特殊情况，不想让外面跟着滚怎么办呢？
## 要求
内部滑动到最上的时候再往上滑无效，同理滑到最下。
## 思路
首先想到 onscroll 事件，可是无奈这个不能判断鼠标发生上下滑动，好像可以用 event 鼠标的位置，但是1鼠标的位置可能根本就不动，虽然听说有 event.scrollx 这个东西，但是在谷歌测试没发现，2他获取的位置是滑动事件发生之前的位置，所以这个没用

第二个想到 onwheel 事件，可惜这个还是没办法判断鼠标发生上下滚动

最后找到了 onmousewheel 事件和 DOMMouseScroll 事件


**[demo](/demo/demo_161214) **

## 重点
在除ff浏览器有一个 onmousewheel 事件，用 wheelDelta 和 scrollTop 进行判断，然后直接返回 false 就可以
```
a.onmousewheel = function (e) {
	if (a.scrollTop == 0 && e.wheelDelta > 0)
		return false;
	if (a.scrollTop == a.scrollHeight - a.clientHeight && e.wheelDelta < 0)
		return false;

}
```

但是ff浏览器就没有这个事件，它只有一个 DOMMouseScroll 事件，而且这个事件还得自己去绑上去 addEventListener ，本身是没有的，并且不让他滚动只能用 e.preventDefault() 这个事件，然后让它能再滚动只能去除 eventlistener 事件，超麻烦。。想了很久之后想出了以下办法，测试没有问题
```
a.addEventListener("DOMMouseScroll", f2)
	function f2(e) {
		if (a.scrollTop == 0 && e.detail < 0) {
			e.preventDefault();
			a.removeEventListener("DOMMouseScroll", f2)
			a.addEventListener("DOMMouseScroll", f2)
			return;
		}
		if (a.scrollTop == a.scrollHeight - a.clientHeight && e.detail > 0) {
			e.preventDefault();
			a.removeEventListener("DOMMouseScroll", f2)
			a.addEventListener("DOMMouseScroll", f2)
			return;
		}
	}
```
## 其他
其实除了这个外，还有个抖机灵的方法，就是 body 设置一个高，然后 overflow:hidden 原理是让 body **【浏览器的滚动条消失，即外部滚动失效】** 但是有时候页面会跳到 overflow 页面最上面，可以再加上scroolTop去定位到原先位置，不过这个方法还是会出现body的滚动条抖动，而且逻辑略微复杂。根据情况，也是一个不错的方法。

________
#### 补充
此方法当元素a本身不可滑动时，在a上面滑动也是不会触发页面的滑动的。如果想要对此修改，请自行判断
________

另外滚动条抖动的解决办法会在另一篇文章里说到。
________


