---
title: 读取文件
categories:
  - 尺工
date: 2017-11-02 14:48:28
---
<p></p>
<!-- more -->

## FileReader
**from mdn**
FileReader 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。

其中File对象可以是来自用户在一个`<input>`元素上选择文件后返回的FileList对象,也可以来自拖放操作生成的 DataTransfer对象,还可以是来自在一个HTMLCanvasElement上执行mozGetAsFile()方法后返回结果.

一般都是通过`<input type=file>`来选择到文件并进行处理。

filereader 有2个常用的读取函数
1. readAsDataURL()
2. readAsText()


第一个一般用于读取图片，以 base64 格式展示
第二个一般用于读取文本文件，以字符串格式展示

另外和 ajax 一样，它的操作也存在状态，`readyState`
同时有相对于的绑定事件响应
```
onabort
当读取操作被中止时调用.
onerror
当读取操作发生错误时调用.
onload
当读取操作成功完成时调用.
onloadend
当读取操作完成时调用,不管是成功还是失败.该处理程序在onload或者onerror之后调用.
onloadstart
当读取操作将要开始之前调用.
onprogress
在读取数据过程中周期性调用.
```
一般在绑定 input 的 onchange 事件上以获取文件，然后进行读取，具体操作在读取完成的 onload 中进行操作
```
var reader = new FileReader()
//获取文件进行读取
input.onchange = function(e){
  reader.readAsDataURL(e.target.files[0]);
}
读取完成
reader.onloadend = function(e){
  var result = e.target.result;
}
```

## 图片处理

input 中还有一个属性可以规定可以选择的类型
`accept="image/gif,image/jpg，image/jpeg,image/png" `
这样可以只选择图片，不过这个可以更改，还是需要再对文件做判断。

然后通过 filereader 去读成 base64 格式，之后可以做上传图片或者用 canvas 进行编辑再通过 `canvas.toDataURL("image/png")`将整个画布转为 base64 再处理。

关于文件的处理mdn上还有许多
[例子](https://developer.mozilla.org/zh-CN/docs/Using_files_from_web_applications)
其中拖拽文件的例子很有意思