---
title: 日常小技巧4
categories:
  - 尺工
date: 2018-03-04 16:34:51
---

<p></p>
<!-- more -->

## gitlab 发布模块

和 npm 不同，没有 npm publish，只是在 gitlab 上新建仓库，然后安装对时候如下面
`"<module-name>": "git+ssh://git@git.mydomain.com:Username/Repository#{branch|tag}"`,

## meta/title

meta 属性也可以被设置`document.querySelector('meta[name="keywords"]').content = 'your'`
title 也是 `document.querySelector('title').innerText | document.title`

## fetch

fetch 为浏览器 windos 的试验方法，需要配合它的 polyfill 库使用，可通过它去比较简单的构造一个 http 请求，该方法会返回一个 promise 对象从而简化传统的 xhr 。fetch 不会主动发送 cookie，可以手动加上 credentials: 'include'

```js
function json(data) {
  return data.json()
}
fetch('url', {
  method: 'post',
  body: _body
})
  .then(json)
  .then(data => {
    console, log(data)
  })
  .catch()
```

## js 创建 script 节点

创建节点带 src 属性事，默认是使用带异步加载，即 async='true'

## 判断资源是否加载完毕

### img

img.onload

### css

对于是自己创建的 style 节点来说，可以从它的一个属性 node.sheet.cssRules 来判读，当加载 css 完毕后，此属性会自动加载到 style 节点上去，此属性就是 style 的样式

对于通过 link 引入的 css 用这个方法有一定的局限性，谷歌内核不支持，cssRules 为 null，ie 和 火狐则可以查询到

### js

对于自己创建的 js 节点，可以使用 `node.onload || node.onreadystatechange`来判断是否加载完

```js
node.onload = function() {
  node.onload = null
  complete(url)
}

node.onreadystatechange = function() {
  if (/loaded|complete/.test(node.readyState)) {
    node.onreadystatechange = null
    complete(url)
  }
}
```
